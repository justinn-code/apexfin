{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">üöÄ Activate ApexFin Coin Investment</h2>

    <p class="text-center">
        To activate your investment and start earning, you need to pay a <strong>1% activation fee</strong> in one of the following payment methods:
    </p>

    <!-- Account Details -->
    <div class="card p-4 shadow-sm">
        <h4>üí∞ Your Account Details:</h4>
        <ul class="list-unstyled">
            <li><strong>Total Balance:</strong> ${{ user_profile.balance }}</li>
            <li><strong>1% Activation Fee:</strong> ${{ activation_fee }} (based on your total balance)</li>
        </ul>
        <p>Ensure that you have sufficient funds in your account to complete the activation. The 1% fee is calculated from your total balance.</p>
    </div>

    <!-- Payment Method Selection -->
    <div class="card mt-4 p-4 shadow-sm">
        <h4>üîó Choose Your Payment Method</h4>
        <p>Select the payment method that works best for you. If you choose "USDT", you'll be given a wallet address to send the payment. If you choose "Gift Card", you'll need to manually enter the gift card code for verification.</p>
        
        <form method="post">
            {% csrf_token %}
            <div class="form-check">
                <input class="form-check-input" type="radio" name="payment_method" id="usdt" value="usdt" required>
                <label class="form-check-label" for="usdt">
                    üí∏ Pay via USDT (Tether)
                </label>
                <p class="text-muted">Choose this if you prefer to pay with USDT cryptocurrency. You will be provided with a wallet address.</p>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="payment_method" id="gift_card" value="gift_card">
                <label class="form-check-label" for="gift_card">
                    üéÅ Pay via Gift Card
                </label>
                <p class="text-muted">Choose this if you are paying with a gift card. After purchasing the gift card, you will need to enter the gift card code for manual verification.</p>
            </div>
            
            <button type="submit" class="btn btn-primary w-100 mt-3">Next Step</button>
        </form>
    </div>

    <!-- USDT Wallet Address Box (Visible when 'usdt' is selected) -->
    <div id="usdt_details" class="card mt-4 p-4 shadow-sm" style="display:none;">
        <h4>üîó Send USDT to the Address Below</h4>
        <p>Please send the exact activation fee amount in USDT to the wallet address provided below. After the payment is confirmed, your account will be activated for profit earning.</p>
        
        {% if wallet_address %}
        <div class="wallet-box d-flex align-items-center p-3 border rounded bg-light">
            <input type="text" value="{{ wallet_address }}" id="walletAddress" readonly class="form-control me-2" style="font-weight: bold;">
            <button onclick="copyWalletAddress()" class="btn btn-success">üìã Copy Wallet Address</button>
        </div>
        {% else %}
        <p class="text-danger">‚ö†Ô∏è Wallet address not found. Please contact support for assistance.</p>
        {% endif %}
    </div>

    <!-- Gift Card Instructions (Visible when 'gift_card' is selected) -->
    <div id="gift_card_details" class="card mt-4 p-4 shadow-sm" style="display:none;">
        <h4>üéÅ Pay via Gift Card</h4>
        <p>To complete the payment via gift card, follow these steps:</p>
        <ol>
            <li>Purchase a gift card of the required amount.</li>
            <li>Enter the gift card code below to verify your payment.</li>
        </ol>
        <p>Once the code is verified, your account will be activated and you can start earning profits.</p>

        <form method="post">
            {% csrf_token %}
            <label class="form-label"><strong>Select Gift Card Type:</strong></label>
            <select class="form-control mb-3" name="gift_card_type" required>
                <option value="amazon">Amazon</option>
                <option value="google_play">Google Play</option>
                <option value="itunes">iTunes</option>
            </select>
            
            <label class="form-label"><strong>Enter Gift Card Code:</strong></label>
            <input type="text" name="gift_card_code" required class="form-control mb-3" placeholder="Paste your gift card code here">
            
            <label class="form-label"><strong>Reference/Note (Optional):</strong></label>
            <input type="text" name="gift_card_reference" class="form-control mb-3" placeholder="Enter a reference or note for verification (Optional)">
            
            <button type="submit" class="btn btn-primary w-100">‚úÖ I've Made the Payment</button>
        </form>
    </div>

    <!-- Instructions Section -->
    <div class="card mt-4 p-4 shadow-sm">
        <h4>üìå How to Activate:</h4>
        <ol>
            <li>Check your <strong>total balance</strong> above.</li>
            <li>Calculate the <strong>1% activation fee</strong> (shown above).</li>
            <li>Choose your preferred payment method and follow the instructions.</li>
            <li>Enter the necessary payment details for your selected method to complete the payment.</li>
        </ol>
        <p class="text-muted">Once your payment is verified, your account will be activated, and you'll be able to earn profits.</p>
    </div>
    
    <p class="text-center mt-3">
        <strong>üîî Important:</strong> Make sure to transfer the exact amount to avoid delays. Your payment will be verified once processed. Contact support if you face any issues.
    </p>
</div>

<!-- Copy Wallet Script -->
<script>
    function copyWalletAddress() {
        var copyText = document.getElementById("walletAddress");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        document.execCommand("copy");
        alert("‚úÖ Wallet Address Copied: " + copyText.value);
    }

    // JavaScript to toggle visibility based on selected payment method
    document.querySelectorAll('input[name="payment_method"]').forEach((input) => {
        input.addEventListener('change', function() {
            // Show/Hide payment details based on the selected method
            if (this.value === 'usdt') {
                document.getElementById('usdt_details').style.display = 'block';
                document.getElementById('gift_card_details').style.display = 'none';
            } else if (this.value === 'gift_card') {
                document.getElementById('usdt_details').style.display = 'none';
                document.getElementById('gift_card_details').style.display = 'block';
            }
        });
    });
</script>

{% endblock %}
